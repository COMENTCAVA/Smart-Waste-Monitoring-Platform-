{% extends 'base.html' %}

{% block title %}Dashboard WDP{% endblock %}

{% block extra_head %}
  <!-- Chart.js only on this page -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3" defer></script>
{% endblock %}

{% block content %}
  <!-- Splash screen -->
  <div id="splash-screen">
    <img
      src="{{ url_for('static', filename='images/logo.png') }}"
      alt="Logo WDP"
      class="splash-logo"
    >
  </div>

  <!-- Résumé global / Accuracy -->
  {% set stats = [
      (_('Total'),           total),
      (_('Vide (manuel)'),   manual_empty_pct|round(1) ~ '%'),
      (_('Pleine (manuel)'), manual_full_pct|round(1) ~ '%'),
      (_('Accuracy'),        correct_pct|round(1) ~ '%')
  ] %}
  <div id="overallStats" class="row g-3 mb-5">
  {% for label, value in stats %}
    <div class="col-6 col-md-3">
      <div class="card stat-card h-100 text-center">
        <div class="stat-label text-secondary">{{ label }}</div>
        <div class="stat-value fs-3 fw-bold">{{ value }}</div>
      </div>
    </div>
  {% endfor %}
</div>

  <!-- Filtres -->
  <div class="row g-3 mb-4">
    <div class="col-md-2">
      <input id="filterDateFrom" type="date" class="form-control">
    </div>
    <div class="col-md-2">
      <input id="filterDateTo"   type="date" class="form-control">
    </div>
    <div class="col-md-2">
      <select id="filterManual" class="form-select">
        <option value="">{{ _('Manuel : Tous') }}</option>
        <option value="Vide">{{ _('Vide') }}</option>
        <option value="Pleine">{{ _('Pleine') }}</option>
      </select>
    </div>
    <div class="col-md-2">
      <select id="filterAuto" class="form-select">
        <option value="">{{ _('Auto : Tous') }}</option>
        <option value="Vide">{{ _('Vide') }}</option>
        <option value="Pleine">{{ _('Pleine') }}</option>
      </select>
    </div>
    <div class="col-md-2">
      <button id="applyFilters" class="btn btn-primary w-100">{{ _('Filtrer') }}</button>
    </div>
  </div>

  <!-- Graphiques -->
  <div class="row gy-4">
    <div class="col-md-6 text-center">
      <h5>{{ _('Camembert de répartition') }}</h5>
      <div id="labelChartContainer">
        <canvas id="labelChart"></canvas>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card chart-card p-3 mb-4">
        <h5>{{ _('Taille de fichier') }}</h5>
        <div class="chart-container">
          <canvas id="fileSizeChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card chart-card p-3 mb-4">
        <h5>{{ _('Contraste') }}</h5>
        <div class="chart-container">
          <canvas id="contrastChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card chart-card p-3 mb-4">
        <h5>{{ _('Contours détectés') }}</h5>
        <div class="chart-container">
          <canvas id="edgesChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Grille d’images -->
  <div id="imagesContainer" class="row row-cols-1 row-cols-md-3 g-4 mt-4"></div>

  <!-- Charger plus -->
  <button id="loadMore" class="btn btn-outline-secondary w-100 my-4">
    Charger plus
  </button>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>

  <script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>

  <!-- Splash logic -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const splash = document.getElementById('splash-screen');
      const logo   = splash.querySelector('.splash-logo');

      // 1) Dès que le "pop" est terminé, on déclenche le fondu
      logo.addEventListener('animationend', () => {
        splash.classList.add('fade-out');
      });

      // 2) Au bout du fondu, on retire le splash du DOM
      splash.addEventListener('animationend', () => {
        splash.remove();
      });
    });
  </script>

{% endblock %}